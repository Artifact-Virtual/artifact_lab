<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AVA Development Studio</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1e1e1e;
            color: #d4d4d4;
            height: 100vh;
            overflow: hidden;
        }
        .container {
            display: flex;
            height: 100vh;
        }
        .sidebar {
            width: 250px;
            background: #252526;
            border-right: 1px solid #3e3e42;
            display: flex;
            flex-direction: column;
        }
        .tab-bar {
            display: flex;
            background: #2d2d30;
            border-bottom: 1px solid #3e3e42;
        }
        .tab {
            padding: 8px 16px;
            cursor: pointer;
            border-right: 1px solid #3e3e42;
            font-size: 12px;
            background: #37373d;
            color: #cccccc;
        }
        .tab.active {
            background: #252526;
            color: #ffffff;
        }
        .tab:hover {
            background: #2a2d2e;
        }
        .panel {
            flex: 1;
            overflow-y: auto;
            display: none;
        }
        .panel.active {
            display: block;
        }
        .panel-header {
            padding: 12px 16px;
            background: #2d2d30;
            border-bottom: 1px solid #3e3e42;
            font-weight: 600;
            font-size: 14px;
        }
        .file-tree {
            padding: 8px 0;
        }
        .file-item {
            padding: 4px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            font-size: 13px;
            border-radius: 0;
        }
        .file-item:hover {
            background: #2a2d2e;
        }
        .file-item.selected {
            background: #094771;
            color: #ffffff;
        }
        .file-item.folder {
            font-weight: 500;
        }
        .file-icon {
            margin-right: 6px;
            width: 16px;
            text-align: center;
        }
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .editor-tabs {
            height: 35px;
            background: #2d2d30;
            border-bottom: 1px solid #3e3e42;
            display: flex;
            align-items: center;
            overflow-x: auto;
        }
        .editor-tab {
            padding: 8px 16px;
            background: #37373d;
            border-right: 1px solid #3e3e42;
            cursor: pointer;
            font-size: 13px;
            color: #cccccc;
            display: flex;
            align-items: center;
            white-space: nowrap;
        }
        .editor-tab.active {
            background: #1e1e1e;
            color: #ffffff;
        }
        .editor-tab.modified::after {
            content: "‚óè";
            margin-left: 6px;
            color: #f44747;
        }
        .tab-close {
            margin-left: 8px;
            cursor: pointer;
            opacity: 0.7;
        }
        .tab-close:hover {
            opacity: 1;
        }
        .toolbar {
            height: 35px;
            background: #2d2d30;
            border-bottom: 1px solid #3e3e42;
            display: flex;
            align-items: center;
            padding: 0 12px;
            gap: 8px;
        }
        .file-path {
            flex: 1;
            font-size: 12px;
            color: #cccccc;
        }
        .toolbar-button {
            padding: 4px 8px;
            background: #0e639c;
            color: white;
            border: none;
            border-radius: 2px;
            cursor: pointer;
            font-size: 11px;
        }
        .toolbar-button:hover {
            background: #1177bb;
        }
        .toolbar-button:disabled {
            background: #3e3e42;
            color: #858585;
            cursor: not-allowed;
        }
        .editor-container {
            flex: 1;
            position: relative;
        }
        .chat-panel {
            width: 350px;
            background: #252526;
            border-left: 1px solid #3e3e42;
            display: flex;
            flex-direction: column;
        }
        .chat-header {
            padding: 12px 16px;
            background: #2d2d30;
            border-bottom: 1px solid #3e3e42;
            font-weight: 600;
            font-size: 14px;
        }
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }
        .message {
            margin-bottom: 16px;
            padding: 12px;
            border-radius: 8px;
        }
        .user-message {
            background: rgba(0, 123, 255, 0.2);
            margin-left: 20px;
        }
        .ai-message {
            background: rgba(255, 255, 255, 0.05);
            margin-right: 20px;
        }
        .chat-input-container {
            padding: 16px;
            border-top: 1px solid #3e3e42;
        }
        .chat-input {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #3e3e42;
            border-radius: 6px;
            color: white;
            outline: none;
            font-size: 14px;
            resize: none;
            min-height: 60px;
        }
        .chat-send {
            margin-top: 8px;
            width: 100%;
            padding: 8px;
            background: #0e639c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .chat-send:hover {
            background: #1177bb;
        }
        .chat-send:disabled {
            background: #3e3e42;
            cursor: not-allowed;
        }
        .status-bar {
            height: 22px;
            background: #007acc;
            color: white;
            display: flex;
            align-items: center;
            padding: 0 12px;
            font-size: 11px;
            justify-content: space-between;
        }
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #858585;
        }
        .error {
            color: #f44747;
            padding: 16px;
        }
        .search-panel {
            padding: 16px;
        }
        .search-input {
            width: 100%;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #3e3e42;
            border-radius: 4px;
            color: white;
            outline: none;
            font-size: 13px;
        }
        .search-results {
            margin-top: 12px;
        }
        .search-result {
            padding: 8px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 12px;
        }
        .search-result:hover {
            background: #2a2d2e;
        }
        .context-menu {
            position: absolute;
            background: #252526;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            padding: 4px 0;
            font-size: 13px;
            z-index: 1000;
            display: none;
        }
        .context-menu-item {
            padding: 8px 16px;
            cursor: pointer;
        }
        .context-menu-item:hover {
            background: #2a2d2e;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Enhanced Sidebar -->
        <div class="sidebar">
            <div class="tab-bar">
                <div class="tab active" onclick="switchTab('files')">Files</div>
                <div class="tab" onclick="switchTab('search')">Search</div>
                <div class="tab" onclick="switchTab('git')">Git</div>
            </div>
            
            <!-- Files Panel -->
            <div class="panel active" id="filesPanel">
                <div class="panel-header">Explorer</div>
                <div class="file-tree" id="fileTree">
                    <div class="loading">Loading files...</div>
                </div>
            </div>
            
            <!-- Search Panel -->
            <div class="panel" id="searchPanel">
                <div class="panel-header">Search</div>
                <div class="search-panel">
                    <input type="text" class="search-input" placeholder="Search files..." id="searchInput">
                    <div class="search-results" id="searchResults"></div>
                </div>
            </div>
            
            <!-- Git Panel -->
            <div class="panel" id="gitPanel">
                <div class="panel-header">Source Control</div>
                <div class="search-panel">
                    <div style="color: #858585; text-align: center; padding: 20px;">
                        Git integration coming soon...
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Editor Tabs -->
            <div class="editor-tabs" id="editorTabs">
                <div class="editor-tab active" data-file="welcome">
                    Welcome
                    <span class="tab-close" onclick="closeTab('welcome')">&times;</span>
                </div>
            </div>
            
            <!-- Toolbar -->
            <div class="toolbar">
                <div class="file-path" id="filePath">Welcome to AVA Development Studio</div>
                <button class="toolbar-button" id="saveBtn" onclick="saveFile()" disabled>Save</button>
                <button class="toolbar-button" id="saveAllBtn" onclick="saveAllFiles()">Save All</button>
                <button class="toolbar-button" onclick="refreshFiles()">Refresh</button>
                <button class="toolbar-button" onclick="createNewFile()">New File</button>
            </div>
            
            <!-- Monaco Editor -->
            <div class="editor-container">
                <div id="monaco-editor" style="height: 100%; width: 100%;"></div>
            </div>
            
            <!-- Status Bar -->
            <div class="status-bar">
                <div id="statusLeft">Ready</div>
                <div id="statusRight">AVA Development Studio</div>
            </div>
        </div>
        
        <!-- AI Chat Panel -->
        <div class="chat-panel">
            <div class="chat-header">
                AVA Assistant
                <div style="font-size: 11px; font-weight: normal; color: #858585;">AI Code Assistant</div>
            </div>
            
            <div class="chat-messages" id="chatMessages">
                <div class="ai-message">
                    Hello! I'm AVA, your AI development assistant. I can help you with:
                    <br>‚Ä¢ Code analysis and suggestions
                    <br>‚Ä¢ File operations and management
                    <br>‚Ä¢ Debugging and optimization
                    <br>‚Ä¢ Project structure guidance
                    <br><br>I can see your current file and make direct modifications. Just ask!
                </div>
            </div>
            
            <div class="chat-input-container">
                <textarea class="chat-input" id="chatInput" placeholder="Ask me anything about your code..." disabled></textarea>
                <button class="chat-send" id="chatSend" onclick="sendMessage()" disabled>Send</button>
            </div>
        </div>
    </div>

    <!-- Context Menu -->
    <div class="context-menu" id="contextMenu">
        <div class="context-menu-item" onclick="contextAction('copy')">Copy</div>
        <div class="context-menu-item" onclick="contextAction('paste')">Paste</div>
        <div class="context-menu-item" onclick="contextAction('delete')">Delete</div>
        <div class="context-menu-item" onclick="contextAction('rename')">Rename</div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>
    <script>
        // Global state
        let editor = null;
        let openFiles = new Map();
        let currentFile = 'welcome';
        let files = [];
        let isConnected = false;

        // Initialize Monaco Editor
        require.config({ 
            paths: { 
                vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs' 
            } 
        });

        require(['vs/editor/editor.main'], function () {
            editor = monaco.editor.create(document.getElementById('monaco-editor'), {
                value: `// Welcome to AVA Development Studio
// Your AI-powered development environment

// Features:
// ‚úì Monaco Editor with full VS Code experience
// ‚úì Multi-file editing with tabs
// ‚úì AI assistant with file context awareness
// ‚úì Advanced file operations and search
// ‚úì Real-time collaboration capabilities
// ‚úì Integrated version control (coming soon)

// Getting Started:
// 1. Browse files in the Explorer panel
// 2. Click any file to open it in a new tab
// 3. Use the AI assistant for code help and modifications
// 4. Save your work with Ctrl+S or the Save button
// 5. Create new files with the New File button

console.log("Welcome to AVA Development Studio!");
`,
                language: 'javascript',
                theme: 'vs-dark',
                automaticLayout: true,
                minimap: { enabled: true },
                fontSize: 14,
                lineNumbers: 'on',
                wordWrap: 'on',
                scrollBeyondLastLine: false,
                smoothScrolling: true,
                cursorBlinking: 'blink',
                renderWhitespace: 'selection',
                bracketPairColorization: { enabled: true },
                guides: { bracketPairs: true },
                formatOnPaste: true,
                formatOnType: true
            });

            // Initialize welcome file
            openFiles.set('welcome', {
                content: editor.getValue(),
                original: editor.getValue(),
                language: 'javascript',
                modified: false
            });

            // Listen for content changes
            editor.onDidChangeModelContent(function() {
                const file = openFiles.get(currentFile);
                if (file) {
                    file.content = editor.getValue();
                    file.modified = file.content !== file.original;
                    updateTabModifiedState(currentFile, file.modified);
                    updateSaveButton();
                }
            });

            // Load initial data
            loadFiles();
            checkAIStatus();
        });

        // Tab management
        function switchToFile(fileName) {
            if (currentFile === fileName) return;
            
            currentFile = fileName;
            const file = openFiles.get(fileName);
            
            if (file) {
                editor.setValue(file.content);
                monaco.editor.setModelLanguage(editor.getModel(), file.language);
                document.getElementById('filePath').textContent = fileName;
                updateActiveTab(fileName);
                updateSaveButton();
            }
        }

        function openFileInTab(fileName, content, language = 'plaintext') {
            if (!openFiles.has(fileName)) {
                openFiles.set(fileName, {
                    content: content,
                    original: content,
                    language: language,
                    modified: false
                });
                createTab(fileName);
            }
            switchToFile(fileName);
        }

        function createTab(fileName) {
            const tabsContainer = document.getElementById('editorTabs');
            const tab = document.createElement('div');
            tab.className = 'editor-tab';
            tab.setAttribute('data-file', fileName);
            tab.innerHTML = `
                ${fileName}
                <span class="tab-close" onclick="closeTab('${fileName}')">&times;</span>
            `;
            tab.onclick = (e) => {
                if (e.target.classList.contains('tab-close')) return;
                switchToFile(fileName);
            };
            tabsContainer.appendChild(tab);
        }

        function closeTab(fileName) {
            if (fileName === 'welcome') return; // Can't close welcome tab
            
            const file = openFiles.get(fileName);
            if (file && file.modified) {
                if (!confirm(`${fileName} has unsaved changes. Close anyway?`)) {
                    return;
                }
            }
            
            openFiles.delete(fileName);
            const tab = document.querySelector(`[data-file="${fileName}"]`);
            if (tab) tab.remove();
            
            if (currentFile === fileName) {
                // Switch to welcome tab or first available tab
                const remainingTabs = document.querySelectorAll('.editor-tab');
                if (remainingTabs.length > 0) {
                    switchToFile(remainingTabs[0].getAttribute('data-file'));
                }
            }
        }

        function updateActiveTab(fileName) {
            document.querySelectorAll('.editor-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-file') === fileName) {
                    tab.classList.add('active');
                }
            });
        }

        function updateTabModifiedState(fileName, modified) {
            const tab = document.querySelector(`[data-file="${fileName}"]`);
            if (tab) {
                if (modified) {
                    tab.classList.add('modified');
                } else {
                    tab.classList.remove('modified');
                }
            }
        }

        // Sidebar tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.panel').forEach(panel => panel.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Panel').classList.add('active');
        }

        // File operations
        async function loadFiles() {
            updateStatus('Loading files...');
            try {
                const response = await fetch('/api/files/list');
                const data = await response.json();
                
                if (data.success) {
                    files = data.items;
                    renderFileTree(files);
                    updateStatus('Ready');
                } else {
                    showError('Failed to load files: ' + (data.error || 'Unknown error'));
                }
            } catch (error) {
                showError('Error loading files: ' + error.message);
            }
        }

        function renderFileTree(items) {
            const tree = document.getElementById('fileTree');
            tree.innerHTML = '';

            if (!items || items.length === 0) {
                tree.innerHTML = '<div class="loading">No files found</div>';
                return;
            }

            // Sort: directories first, then files
            items.sort((a, b) => {
                if (a.type === 'directory' && b.type === 'file') return -1;
                if (a.type === 'file' && b.type === 'directory') return 1;
                return a.name.localeCompare(b.name);
            });

            items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'file-item';
                
                if (item.type === 'directory') {
                    div.className += ' folder';
                    div.innerHTML = `<span class="file-icon">üìÅ</span>${item.name}`;
                    // TODO: Add folder expansion functionality
                } else {
                    div.innerHTML = `<span class="file-icon">${getFileIcon(item.name)}</span>${item.name}`;
                    div.onclick = () => openFile(item.name);
                    div.oncontextmenu = (e) => showContextMenu(e, item.name);
                }
                
                tree.appendChild(div);
            });
        }

        function getFileIcon(fileName) {
            const ext = fileName.split('.').pop().toLowerCase();
            const icons = {
                'js': 'üìú', 'ts': 'üìò', 'py': 'üêç', 'html': 'üåê', 'css': 'üé®',
                'json': 'üìã', 'md': 'üìù', 'yml': '‚öôÔ∏è', 'yaml': '‚öôÔ∏è',
                'xml': 'üìÑ', 'sql': 'üóÉÔ∏è', 'sh': '‚ö°', 'bat': '‚ö°', 'ps1': 'üíô'
            };
            return icons[ext] || 'üìÑ';
        }

        async function openFile(fileName) {
            updateStatus('Opening ' + fileName + '...');
            
            try {
                const response = await fetch(`/api/files/read?path=${encodeURIComponent(fileName)}`);
                const data = await response.json();
                
                if (data.success) {
                    // Detect language
                    const extension = fileName.split('.').pop().toLowerCase();
                    const languageMap = {
                        'js': 'javascript', 'ts': 'typescript', 'py': 'python',
                        'html': 'html', 'css': 'css', 'json': 'json',
                        'md': 'markdown', 'yml': 'yaml', 'yaml': 'yaml',
                        'xml': 'xml', 'sql': 'sql', 'sh': 'shell',
                        'bat': 'bat', 'ps1': 'powershell', 'cpp': 'cpp',
                        'c': 'c', 'java': 'java', 'go': 'go', 'rs': 'rust',
                        'php': 'php', 'rb': 'ruby'
                    };
                    
                    const language = languageMap[extension] || 'plaintext';
                    openFileInTab(fileName, data.content, language);
                    
                    // Highlight selected file
                    document.querySelectorAll('.file-item').forEach(item => {
                        item.classList.remove('selected');
                    });
                    event.target.classList.add('selected');
                    
                    updateStatus('Opened ' + fileName);
                } else {
                    showError('Failed to open file: ' + (data.error || 'Unknown error'));
                }
            } catch (error) {
                showError('Error opening file: ' + error.message);
            }
        }

        async function saveFile() {
            if (!currentFile || currentFile === 'welcome') return;
            
            const file = openFiles.get(currentFile);
            if (!file) return;

            updateStatus('Saving ' + currentFile + '...');
            
            try {
                const response = await fetch('/api/files/write', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        path: currentFile, 
                        content: file.content 
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    file.original = file.content;
                    file.modified = false;
                    updateTabModifiedState(currentFile, false);
                    updateSaveButton();
                    updateStatus('Saved ' + currentFile);
                } else {
                    showError('Failed to save file: ' + (data.error || 'Unknown error'));
                }
            } catch (error) {
                showError('Error saving file: ' + error.message);
            }
        }

        async function saveAllFiles() {
            const modifiedFiles = Array.from(openFiles.entries())
                .filter(([name, file]) => file.modified && name !== 'welcome');
            
            for (const [fileName, file] of modifiedFiles) {
                const oldFile = currentFile;
                currentFile = fileName;
                await saveFile();
                currentFile = oldFile;
            }
        }

        function createNewFile() {
            const fileName = prompt('Enter new file name:');
            if (fileName && fileName.trim()) {
                const trimmedName = fileName.trim();
                const extension = trimmedName.split('.').pop().toLowerCase();
                const languageMap = {
                    'js': 'javascript', 'ts': 'typescript', 'py': 'python',
                    'html': 'html', 'css': 'css', 'json': 'json'
                };
                const language = languageMap[extension] || 'plaintext';
                
                openFileInTab(trimmedName, '', language);
                updateStatus('Created new file: ' + trimmedName);
            }
        }

        async function refreshFiles() {
            await loadFiles();
        }

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const query = e.target.value.toLowerCase();
            const results = document.getElementById('searchResults');
            
            if (query.length < 2) {
                results.innerHTML = '';
                return;
            }
            
            const matchingFiles = files.filter(file => 
                file.type === 'file' && file.name.toLowerCase().includes(query)
            );
            
            results.innerHTML = matchingFiles.map(file => 
                `<div class="search-result" onclick="openFile('${file.name}')">
                    ${getFileIcon(file.name)} ${file.name}
                </div>`
            ).join('');
        });

        // AI Chat functionality
        async function checkAIStatus() {
            try {
                const response = await fetch('/status');
                const data = await response.json();
                
                const chatInput = document.getElementById('chatInput');
                const chatSend = document.getElementById('chatSend');
                
                if (data.status === 'ready') {
                    chatInput.disabled = false;
                    chatSend.disabled = false;
                    isConnected = true;
                    updateStatus('AI Assistant Ready');
                } else {
                    updateStatus('AI Assistant Offline');
                }
            } catch (error) {
                updateStatus('AI Assistant Offline');
            }
        }

        async function sendMessage() {
            if (!isConnected) return;
            
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;
            
            // Add user message
            addChatMessage(message, true);
            input.value = '';
            
            // Prepare context
            const context = {
                currentFile: currentFile !== 'welcome' ? currentFile : null,
                fileContent: currentFile !== 'welcome' ? openFiles.get(currentFile)?.content : null,
                openFiles: Array.from(openFiles.keys()).filter(name => name !== 'welcome')
            };
            
            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        message: message,
                        context: context
                    })
                });
                
                const data = await response.json();
                
                if (data.response) {
                    addChatMessage(data.response, false);
                    
                    // Handle file operations if suggested by AI
                    if (data.fileOperations) {
                        // TODO: Implement AI-suggested file operations
                    }
                }
            } catch (error) {
                addChatMessage('Sorry, I encountered an error. Please try again.', false);
            }
        }

        function addChatMessage(message, isUser) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = isUser ? 'user-message message' : 'ai-message message';
            messageDiv.textContent = message;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Context menu
        function showContextMenu(e, fileName) {
            e.preventDefault();
            const menu = document.getElementById('contextMenu');
            menu.style.display = 'block';
            menu.style.left = e.pageX + 'px';
            menu.style.top = e.pageY + 'px';
            menu.dataset.fileName = fileName;
        }

        function contextAction(action) {
            const menu = document.getElementById('contextMenu');
            const fileName = menu.dataset.fileName;
            menu.style.display = 'none';
            
            switch (action) {
                case 'delete':
                    if (confirm(`Delete ${fileName}?`)) {
                        // TODO: Implement file deletion
                        updateStatus(`Delete ${fileName} - Not implemented yet`);
                    }
                    break;
                case 'rename':
                    const newName = prompt('New name:', fileName);
                    if (newName && newName !== fileName) {
                        // TODO: Implement file renaming
                        updateStatus(`Rename ${fileName} to ${newName} - Not implemented yet`);
                    }
                    break;
            }
        }

        // Utility functions
        function updateSaveButton() {
            const file = openFiles.get(currentFile);
            const saveBtn = document.getElementById('saveBtn');
            saveBtn.disabled = !file || !file.modified || currentFile === 'welcome';
        }

        function updateStatus(message) {
            document.getElementById('statusLeft').textContent = message;
        }

        function showError(message) {
            document.getElementById('statusLeft').textContent = message;
            document.getElementById('statusLeft').style.color = '#f44747';
            setTimeout(() => {
                document.getElementById('statusLeft').style.color = '';
            }, 5000);
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                if (e.key === 's') {
                    e.preventDefault();
                    saveFile();
                } else if (e.key === 'r') {
                    e.preventDefault();
                    refreshFiles();
                } else if (e.key === 'n') {
                    e.preventDefault();
                    createNewFile();
                } else if (e.shiftKey && e.key === 'S') {
                    e.preventDefault();
                    saveAllFiles();
                }
            }
            
            if (e.key === 'Enter' && e.target.id === 'chatInput') {
                if (e.ctrlKey) {
                    sendMessage();
                }
            }
        });

        // Hide context menu on click outside
        document.addEventListener('click', function() {
            document.getElementById('contextMenu').style.display = 'none';
        });

        // Chat input auto-resize
        document.getElementById('chatInput').addEventListener('input', function(e) {
            e.target.style.height = 'auto';
            e.target.style.height = Math.min(e.target.scrollHeight, 120) + 'px';
        });
    </script>
</body>
</html>
